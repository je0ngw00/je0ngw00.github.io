---
title: "AWS SQS+SNS vs Kafka: 선택 기준과 비용 비교"
date: 2023-06-07 10:00:00 +0900
categories: [Development, AWS]
tags: [aws, sqs, sns, kafka, msk, event-driven, comparison]
---

## 개요

이벤트 기반 아키텍처를 도입할 때 AWS SQS+SNS와 Kafka(Amazon MSK) 중 어떤 것을 선택해야 할지 고민했습니다. 결론적으로 SQS+SNS를 선택했는데, 그 과정에서 비교한 내용을 정리합니다.

> **시리즈**: [AWS SQS+SNS 기본 개념](/posts/aws-sqs-sns-intro/) · [LocalStack으로 로컬 테스트 환경 구축하기](/posts/localstack-sqs-sns-part1/)

## 핵심 차이점

### 메시지 처리 방식

| 특성 | SQS+SNS | Kafka |
|------|---------|-------|
| 메시지 보관 | 처리 후 삭제 | 설정 기간 동안 보관 |
| 재처리 | DLQ 통해 수동 재처리 | offset 조정으로 언제든 재처리 |
| 메시지 순서 | FIFO 큐 사용 시 보장 | 파티션 내 순서 보장 |
| 동일 메시지 다중 소비 | 불가 (컨슈머 그룹 없음) | 여러 컨슈머 그룹이 같은 메시지 소비 가능 |

### 아키텍처 차이

**SQS+SNS**: Push 기반
```
Producer → SNS → SQS → Consumer (폴링)
```
- SNS가 SQS에 메시지를 push
- Consumer가 SQS를 polling

**Kafka**: Pull 기반
```
Producer → Kafka Broker → Consumer (offset 기반)
```
- Consumer가 자신의 속도로 pull
- offset으로 어디까지 읽었는지 관리

## 비용 비교 (서울 리전 기준)

### AWS SQS+SNS

**과금 방식**: 요청 수 기반

| 항목 | 비용 |
|------|------|
| SNS 발행 | $0.50 / 100만 건 |
| SQS 요청 | $0.40 / 100만 건 (처음 100만 건 무료) |
| 데이터 전송 | $0.09 / GB (10GB 이후) |

**월 1000만 건 처리 시 예상 비용**:
- SNS: $5.00
- SQS: $3.60 (무료 티어 제외)
- **총 약 $8.60/월**

### Amazon MSK (Kafka)

**과금 방식**: 인스턴스 + 스토리지 기반

| 항목 | 비용 (최소 구성) |
|------|------|
| kafka.m5.large × 3 브로커 | $0.21/시간 × 3 = $454/월 |
| 스토리지 100GB × 3 | $0.10/GB × 300 = $30/월 |
| 데이터 전송 | 별도 |

**최소 구성 예상 비용**: **약 $484/월**

### 비용 비교 요약

| 월간 메시지 | SQS+SNS | MSK (최소 구성) |
|------------|---------|-----------------|
| 100만 건 | ~$1 | ~$484 |
| 1000만 건 | ~$9 | ~$484 |
| 1억 건 | ~$86 | ~$484 |
| 10억 건 | ~$860 | ~$484 |

**분기점**: 약 5억 건/월 이상에서 MSK가 경제적

> 실제 비용은 메시지 크기, 보관 기간, 네트워크 비용에 따라 달라집니다.

## 처리량과 성능

### SQS

- 표준 큐: 무제한 TPS
- FIFO 큐: 3,000 TPS (배치 시 30,000)
- 메시지 최대 크기: 256KB

### Kafka (MSK)

- 초당 수백만 메시지 처리 가능
- 메시지 최대 크기: 기본 1MB (설정 변경 가능)
- 파티션 수에 따라 병렬 처리량 확장

## 선택 기준

### SQS+SNS가 적합한 경우

1. **메시지량이 많지 않음**: 월 5억 건 이하
2. **단순한 이벤트 전달**: Fire-and-forget 패턴
3. **AWS 서비스 통합**: Lambda, EventBridge 등과 연동
4. **운영 부담 최소화**: 관리형 서비스 선호
5. **빠른 도입**: 러닝커브 낮음

### Kafka가 적합한 경우

1. **대용량 실시간 처리**: 초당 수십만 건 이상
2. **이벤트 소싱**: 메시지 히스토리 필요
3. **복잡한 스트림 처리**: Kafka Streams, KSQL 활용
4. **다중 컨슈머**: 같은 메시지를 여러 시스템에서 소비
5. **메시지 재처리**: offset 기반 자유로운 재처리 필요

## 실무 선택 사례

### 우리 팀의 선택: SQS+SNS

**상황**:
- 월 메시지량: 약 500만 건
- 도메인 간 이벤트 전달 목적
- 팀 내 Kafka 운영 경험 없음
- 빠른 도입 필요

**선택 이유**:
1. 비용: $5/월 vs $484/월
2. 운영: 관리형 서비스로 운영 부담 없음
3. 러닝커브: 팀 전체가 빠르게 적응 가능
4. 요구사항 충족: 현재 기능으로 충분

**트레이드오프**:
- 메시지 재처리가 번거로움 (DLQ 수동 처리)
- 이벤트 히스토리 조회 불가

## 마이그레이션 고려사항

나중에 Kafka로 전환해야 한다면:

1. **인터페이스 추상화**: 발행/구독 인터페이스를 추상화해두면 교체가 쉬움
2. **메시지 포맷**: Avro, Protobuf 같은 스키마 기반 포맷 사용
3. **멱등성 보장**: 어떤 시스템이든 중복 처리 대응 필요

```java
// 인터페이스 추상화 예시
public interface EventPublisher {
    void publish(String topic, Object event);
}

// SQS+SNS 구현
public class SnsEventPublisher implements EventPublisher { ... }

// Kafka 구현 (나중에 교체)
public class KafkaEventPublisher implements EventPublisher { ... }
```

## 정리

| 기준 | SQS+SNS | Kafka |
|------|---------|-------|
| 비용 (소규모) | ✅ 저렴 | ❌ 고정비 높음 |
| 비용 (대규모) | ❌ 비례 증가 | ✅ 고정비 |
| 운영 부담 | ✅ 거의 없음 | ❌ 클러스터 관리 필요 |
| 러닝커브 | ✅ 낮음 | ❌ 높음 |
| 처리량 | ⚠️ FIFO 제한 | ✅ 무제한 확장 |
| 메시지 재처리 | ❌ 제한적 | ✅ 자유로움 |
| AWS 통합 | ✅ 우수 | ⚠️ 제한적 |

대부분의 중소규모 서비스에서는 SQS+SNS로 시작하고, 요구사항이 커지면 Kafka를 검토하는 것이 현실적인 접근입니다.
